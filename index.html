<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#f8fafc" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/favicon.png">
    <title>Meteo 7 jours - La Foux d'Allos</title>
    <link rel="stylesheet" href="style.css?v=3.32">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>

<!-- Barre fixe en haut : Date + Toggle thème + Toggle source -->
<header class="top-bar">
    <div class="top-bar-left">
        <h1 id="current-date">La Foux d'Allos</h1>
    </div>
    <div class="top-bar-right">
        <button class="refresh-btn" id="refresh-btn" onclick="App.refreshData()" title="Rafraîchir les données">
            <i data-lucide="refresh-cw"></i>
        </button>
        <button class="theme-toggle" onclick="App.toggleTheme()" title="Changer le thème">
            <i data-lucide="sun" class="icon-light"></i>
            <i data-lucide="moon" class="icon-dark"></i>
        </button>
        <button class="source-toggle" id="global-source-toggle" onclick="App.toggleGlobalSource()" title="Changer la source météo">
            <span class="source-label">Open<br>Meteo</span>
            <i data-lucide="arrow-left-right" class="lucide"></i>
        </button>
    </div>
</header>

<!-- Contenu principal -->
<main id="content">
    <!-- Skeleton loader initial (remplacé par JS) -->
    <div class="skeleton-loader">
        <div class="skeleton-text">
            <i data-lucide="loader-2" class="lucide lucide-spin"></i>
            <span>Chargement des prévisions...</span>
        </div>
        <div class="skeleton-section">
            <div class="skeleton-summary">
                <div class="skeleton-summary-item skeleton" style="width: 80px"></div>
                <div class="skeleton-summary-item skeleton" style="width: 70px"></div>
                <div class="skeleton-summary-item skeleton" style="width: 75px"></div>
                <div class="skeleton-summary-item skeleton" style="width: 65px"></div>
            </div>
            <div class="skeleton-chart">
                <div class="skeleton-bar skeleton" style="height: 40%"></div>
                <div class="skeleton-bar skeleton" style="height: 65%"></div>
                <div class="skeleton-bar skeleton" style="height: 55%"></div>
                <div class="skeleton-bar skeleton" style="height: 80%"></div>
                <div class="skeleton-bar skeleton" style="height: 70%"></div>
                <div class="skeleton-bar skeleton" style="height: 50%"></div>
                <div class="skeleton-bar skeleton" style="height: 75%"></div>
                <div class="skeleton-bar skeleton" style="height: 60%"></div>
                <div class="skeleton-bar skeleton" style="height: 45%"></div>
                <div class="skeleton-bar skeleton" style="height: 70%"></div>
                <div class="skeleton-bar skeleton" style="height: 85%"></div>
                <div class="skeleton-bar skeleton" style="height: 55%"></div>
                <div class="skeleton-bar skeleton" style="height: 40%"></div>
                <div class="skeleton-bar skeleton" style="height: 60%"></div>
                <div class="skeleton-bar skeleton" style="height: 75%"></div>
                <div class="skeleton-bar skeleton" style="height: 50%"></div>
                <div class="skeleton-bar skeleton" style="height: 65%"></div>
                <div class="skeleton-bar skeleton" style="height: 45%"></div>
                <div class="skeleton-bar skeleton" style="height: 55%"></div>
                <div class="skeleton-bar skeleton" style="height: 70%"></div>
                <div class="skeleton-bar skeleton" style="height: 60%"></div>
                <div class="skeleton-bar skeleton" style="height: 50%"></div>
                <div class="skeleton-bar skeleton" style="height: 65%"></div>
                <div class="skeleton-bar skeleton" style="height: 45%"></div>
            </div>
            <div class="skeleton-cards">
                <div class="skeleton-card">
                    <div class="skeleton-time skeleton"></div>
                    <div class="skeleton-icon skeleton"></div>
                    <div class="skeleton-temp skeleton"></div>
                    <div class="skeleton-data">
                        <div class="skeleton-line skeleton" style="width: 85%"></div>
                        <div class="skeleton-line skeleton" style="width: 65%"></div>
                    </div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton-time skeleton"></div>
                    <div class="skeleton-icon skeleton"></div>
                    <div class="skeleton-temp skeleton"></div>
                    <div class="skeleton-data">
                        <div class="skeleton-line skeleton" style="width: 85%"></div>
                        <div class="skeleton-line skeleton" style="width: 65%"></div>
                    </div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton-time skeleton"></div>
                    <div class="skeleton-icon skeleton"></div>
                    <div class="skeleton-temp skeleton"></div>
                    <div class="skeleton-data">
                        <div class="skeleton-line skeleton" style="width: 85%"></div>
                        <div class="skeleton-line skeleton" style="width: 65%"></div>
                    </div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton-time skeleton"></div>
                    <div class="skeleton-icon skeleton"></div>
                    <div class="skeleton-temp skeleton"></div>
                    <div class="skeleton-data">
                        <div class="skeleton-line skeleton" style="width: 85%"></div>
                        <div class="skeleton-line skeleton" style="width: 65%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Barre de navigation en bas (mobile) / en haut du contenu (desktop) -->
<nav class="bottom-nav">
    <div class="altitude-tabs" id="altitude-tabs">
        <!-- Tabs altitudes générés dynamiquement -->
    </div>
    <div class="day-nav" id="day-nav">
        <!-- Navigation jours générée dynamiquement -->
    </div>
</nav>

<footer>
    <div><strong>Modèles</strong> :<br> Open-Meteo (best_match → Météo-Fra. AROME) · MET Norway</div>
    <details>
        <summary>Comment sont calculées les prévisions ?</summary>
        <p><strong>Sources</strong> : Fusion de deux APIs — Open-Meteo (prioritaire, 7 jours) et MET Norway (fallback). Les données sont mises en cache 15 minutes.</p>
        <p><strong>Priorité des modèles</strong> : Température, vent, UV → best_match → AROME HD → Météo-France Seamless. Précipitations et codes météo → best_match → AROME → Seamless. Isotherme 0°C → best_match avec fallback MeteoSwiss.</p>
        <p><strong>Cohérence</strong> : Si best_match indique un code météo de précipitation (pluie/neige) sans données de précipitation associées, fallback automatique sur Météo-France AROME pour cette heure.</p>
        <p><strong>Calcul de la neige</strong> : Méthode Roebber avec ratio neige/eau dynamique (base 14:1), calibrée pour les Alpes. Le ratio est ajusté selon : température (plus froid = neige plus légère), humidité (>90% = neige plus dense), vent (>3 m/s = compaction). La valeur retenue est le maximum entre Open-Meteo et Roebber.</p>
        <p><strong>Qualité de neige</strong> : "Sèche" si température ≤ -2°C ou point de rosée ≤ -3°C, "humide" sinon.</p>
        <p><strong>Classification neige/pluie</strong> : Les précipitations sont classées comme neige si température ≤ 1.5°C ET point de rosée ≤ 0.5°C.</p>
        <p><strong>Isotherme 0°C</strong> : Corrigé automatiquement via MeteoSwiss lorsqu'une inversion thermique est détectée (température négative mais isotherme au-dessus de l'altitude).</p>
        <p><strong>Points de mesure</strong> : Station (1794m), Vescal (2050m), Observatoire (2600m) — coordonnées GPS spécifiques à La Foux d'Allos.</p>
    </details>
</footer>

<!-- Scripts JS séparés -->
<script src="js/core.js?v=1.4"></script>
<script src="js/ui.js?v=1.5"></script>

</body>
</html>
